---
title: 数据类型
date: 2020-10-21 09:29:32
tags: redis
categories: redis
---
##  字符串

{% asset_img 字符串结构形式.png 字符串结构形式 %}

### 使用场景

- 缓存
- 计数器
- 分布式锁
- 。。。

### get、set、del

```sql
# 获取key对应的value
get key

# 设置key-value
set key value

# 删除key-value
del key
```

### incr、decr、incrby、decrby

```sql
# key自增1，如果key不存在 ，自增后get(key) = 1
incr key

# key自减1，如果key不存在，自减后get(key) = -1
decr key

# key自增k，如果key不存在，自增后get(key)= k
incrby key k

# key自减k，如果key不存在，自减后get(key)= -k
decrby key k
```

#### 实战

1. 记录网站每个用户个人主页的访问量？
    `incr userId:pageview (单线程：无竞争)`
2. 缓存视频的基本信息（数据源在MySQL中）
3. 分布式id生成器 incr id

### set setnx setxx

```sql
# 不管key是否存在，都设置
set key value

# key不存在，才设置
setnx key value

# key存在，才设置
set key value xx
```

### mget mset

```sql
# 批量获取key，原子操作
mget key1 key2 key3

# 批量设置key-value
mset key1 value1 key2 value2 key3 value3
```

### getset、append、strlen

```sql
# set key newvalue 并返回旧的value
getset key newvalue

# 将value追加到旧的value
append key value

# 返回字符串的长度（注意中文）
strlen key
```

### incrbyfloat、getrange、setrange

```sql
# 增加key对应的 值3.5
inicrbyfloat key 3.5

# 获取字符串指定下标所有的值
getrange key start end

# 设置指定下标所有对应的值
setrange key index value
```

## 哈希

{% asset_img 哈希结构形式.png 哈希结构形式 %}

filed不能相同，value可以相同，所有哈希的命令都是以h开头

### hget、hset、hdel

```sql
# 获取hash key对应的field的value
hget key field
# 获取key的所有field和value
hgetall key

# 设置hash key对应的field的value
hset key field value

# 删除hash key对应field的value
hdel key field
```

### hexists、hlen

```sql
# 判断hash key是否有field
hexists key field

# 获取hash key field的数量
hlen key

```

### hmget、hmset

```sql
# 批量获取hash key的一批field对应的值
hmget key field1 field2.... fieldN

# 批量设置hashkey的一批field value
hmset key field1 value1 field2 value2...fieldN valueN

```

### 实战

1. 记录网站每个用户个人主页的访问量？
    `hincrby user:1:info pageview 1`

### hgetall、hvals、hkeys

```sql
# 返回hash key对应所有的field和value
hgetall key

# 返回hash key对应所有field的value
hvals key

# 返回hash key对应所有field
hkeys key
```

## list

{% asset_img 列表结构形式.png 列表结构形式 %}

特点：有序、可以重复、左右两边可以插入弹出

### 添加

#### rpush

```sql
# 从列表右端插入值 （1-N个）
rpush key value1 value2 ... valueN
```

#### lpush

```sql
# 从列表左端插入值 （1-N个）
lpush key value1 value2 ... valueN
```

#### linsert

```sql
# 在list指定的值前|后插入newValue
linsert key before|after value newValue

linsert listkey before b java
```

### 删除

#### lpop、rpop

```sql
# 从列表左侧弹出一个item
lpop key

# 从列表右侧弹出一个item
rpop key
```

#### blpop、brpop

```sql
# lpop阻塞版本，timeout是阻塞超时时间，timeout=0为永远不阻塞
blpop key timeout

# rpop阻塞版本，timeout是阻塞超时时间，timeout=0为永远不阻塞
brpop key timeout
```

#### lrem

```sql
lrem key count value
# 根据count值，从列表中删除所有value相等的项
（1）count > 0,从左到右，删除最多count个value相等的项
（2）count < 0,从右到左，删除最多Math.abs(count)个value相等的 项
（3）count = 0,删除所有value相等的项
```

#### ltrim

```sql
# 按照索引范围修剪列表
ltrim key start end
```

### 查

#### lrange

```sql
# 获取列表指定索引范围所有item
lrange key start end（包含end）
```

{% asset_img 列表索引.png 列表索引 %}

```sql
127.0.0.1:6379> rpush listkey a b c d e f
(integer) 6
127.0.0.1:6379> lrange listkey 0 2
1) "a"
2) "b"
3) "c"
127.0.0.1:6379> lrange listkey 1 -1
1) "b"
2) "c"
3) "d"
4) "e"
5) "f"
127.0.0.1:6379> lrange listkey -1 -6
(empty list or set)
127.0.0.1:6379> lrange listkey -6 -1
1) "a"
2) "b"
3) "c"
4) "d"
5) "e"
6) "f"
```

#### lindex

```sql
# 获取列表指定索引的item
lindex key index
```

#### llen

```sql
# 获取列表长度
llen key
```

### 改

#### lset

```sql
# 设置列表指定索引值为newValue
lset key index newValue
```

### TIP

1. LRUSH + LPOP = Stack
2. LPUSH + RPOP = Queue
3. LPUSH + LTRIM = Capped Collection
4. LPUSH + BRPOP = Message Queue

##  set

{% asset_img 集合结构形式.png 集合结构形式 %}

### sadd、srem

```sql
# 向集合key添加element（如果element已经存在，添加失败）
sadd key element

# 将集合key中的element移除掉
srem key element
```

### scard、sismember、srandmember、smembers

```sql
# 计算集合大小
scard user:1:follow 
= 4 

# 判断it是否再集合中
sismember user:1:follow it
= 1 (存在)

# 从集合中随机挑count个元素
srandmember user:1:follow count
= his

# 从集合中随机弹出一个元素(原集合中该元素移除)
spop user:1:follow
= sports

# 获取集合所有元素（无序，小心使用）
smembers user:1:follow
= musisc his sports it
```

### sdiff、sinter、sunion

```sql
sadd user:1:follow it his music sports
sadd user:2:follow it news ent sports

# 差集
sdiff user:1:follow user:2:follow
= music his

# 交集
sinter user:1:follow user:2:follow
= it sports

# 并集
sunion user:1:follow user:2:follow
= it music his sports news ent

# 将差集、交集、并集结果保存再destkey中
sdiff|sinteer|suion + store destkey ..
```

## zset

{% asset_img 有序集合结构形式.png 有序集合结构形式 %}

### zadd、zrem、zscore、zincrby、zcard、zrank、zrange、zrangebyscore、zcount、zremrangebyrank、zremrangebyscore

```sql
# 添加score和element
zadd key score element（可以是多对）

# 删除元素
zrem  key element （可以是多个）

# 返回元素的分数
zscore key element

# 增加或减少元素的分数
zincrby key increScore element

# 返回元素的总个数
zcard key

# 返回元素的排名
zrank key element
zrevrank（倒序）

# 返回指定索引范围内的升序元素[分值]
zrange key start end [WITHSCORES]
zrevrange（降序）

# 返回指定分数范围内的升序元素[分值]
zrangebyscore key minScore maxScore [WITHSCORES]
zrevrangebyscore

# 返回有序集合内在指定分数范围内的个数
zcount key minScore maxScore

# 删除指定排名内的升序元素
zremrangebyrank key start end

# 删除指定分数内的升序元素
zremrangebyscore key minScore maxScore

# 交集
zinterstore key1 key2

# 并集
zunionstore key1 key2

```

### 实战

1. 排行榜
